tinymce.PluginManager.add('newvisionGallery', function(editor, url) {
    // Add a button that opens a window
    editor.addButton('newvisionGallery', {
        image: url + '/img/icon.png',
        icon: true,
        onclick: function() {
            console.log();
            // Open window
            $.ajax({
                url: editor.settings.newvision_gallery_rest,
                type: 'post',
                dataType: 'JSON'
            }).done(function(data){
                console.log(data);
                editor.windowManager.open({
                    title: 'NewVision Gallery',
                    width: 400,
                    height: 80,
                    body: [
                        {type: 'listbox', name: 'gallery', label: 'Галерия', 'values': data}
                    ],
                    onsubmit: function(e) {
                        // Insert content when the window form is submitted
                        editor.insertContent('{gallery=' + e.data.gallery+'}');
                    }
                });
            });

        }
    });
});